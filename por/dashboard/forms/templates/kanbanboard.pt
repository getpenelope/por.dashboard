<html metal:use-macro="main.macros['master']">
  <body>
    <div metal:fill-slot="main">
      <tal:tabs replace="structure actions.tabs(request)" tal:condition="actions.has_key('tabs')"/>
      <div ng-app="kanban">
        <div class="kanban" ng-controller="KanbanCtrl"> 
          <table class="table rounded" border="1" ng-init="init('${request.model_instance.id}')">
                 <tr id="task_pool_header_container">
                   <th class="task_pool_header dotted_separator" ng-repeat="column in columns">
                     <div class="header_name click">
                       <img class="title_bullet" src="/fanstatic/por/por_kanban/img/mookup/bullet.png">
                       <span>{{column.title}}</span>
                      </div>
                      <div wip="{{column.wip}}" class="WIP">WIP: {{column.wip}}</div>
                    </th>
                 </tr>
                 <tr id="task_pool_container">
                   <td class="task_pool ui-sortable dotted_separator" ng-repeat="column in columns" data-drop="true" ng-model="columns[$index].tasks" jqyoui-droppable="{multiple:true, onDrop:'dropCallback'}">
                     <div class="big_container" id="{{task.id}}" 
                        data-drag="true" jqyoui-draggable="{animate:true, placeholder:true, index:{{$index}}}" data-jqyoui-options="{revert: 'invalid'}" 
                        ng-repeat="task in column.tasks"  
                        ng-model="columns[$parent.$index].tasks[$index]"
                        ng-show="task.id">
                       <div class="box_itm rounded">
                         <strong><a target="_blank" href="{{task.url}}">{{task.project}} #{{task.id}}</a></strong>
                         <br>
                         {{task.summary}}
                       </div>
                     <div class="shadow"></div>
                    </div>
                   </td>
                 </tr>
               </table>
            </div>
            <fieldset class="form-actions">
              <div class="fa_controls" tal:content="structure actions.buttons(request)"></div>
            </fieldset>
        </div>
    </div>
  </body>
</html>

